(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{790:(e,t,a)=>{"use strict";a.d(t,{default:()=>k});var r=a(5155),i=a(2115),s=a(2821),l=a(5889);function n(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,l.QP)((0,s.$)(t))}function d(e){let{className:t,...a}=e;return(0,r.jsx)("div",{"data-slot":"card",className:n("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",t),...a})}function o(e){let{className:t,...a}=e;return(0,r.jsx)("div",{"data-slot":"card-header",className:n("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-2 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",t),...a})}function c(e){let{className:t,...a}=e;return(0,r.jsx)("div",{"data-slot":"card-title",className:n("leading-none font-semibold",t),...a})}function u(e){let{className:t,...a}=e;return(0,r.jsx)("div",{"data-slot":"card-content",className:n("px-6",t),...a})}var m=a(6673);let v=(0,a(3101).F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-white hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9","icon-sm":"size-8","icon-lg":"size-10"}},defaultVariants:{variant:"default",size:"default"}});function x(e){let{className:t,variant:a,size:i,asChild:s=!1,...l}=e,d=s?m.DX:"button";return(0,r.jsx)(d,{"data-slot":"button",className:n(v({variant:a,size:i,className:t})),...l})}function h(e){var t,a;let{steps:i=[],stepIndex:s=0,className:l=""}=e,n=Math.max(i.length,1),d=Math.min(s+1,n),o=Math.max(0,Math.min(100,s/Math.max(n-1,1)*100));return(0,r.jsx)("div",{className:"sticky top-0 z-30 border-b border-[var(--clr-border)] bg-[var(--clr-bg)]/80 backdrop-blur pointer-events-none ".concat(l),children:(0,r.jsxs)("div",{className:"mx-auto w-full max-w-[var(--maxw)] px-[var(--pad)] py-3",children:[(0,r.jsxs)("div",{className:"relative h-3 rounded-full bg-[var(--clr-border)]",children:[(0,r.jsx)("div",{className:"absolute left-0 top-0 h-3 rounded-full bg-[var(--clr-primary)]",style:{width:"".concat(o,"%")},"aria-hidden":!0}),(0,r.jsxs)("div",{className:"absolute -top-3 h-8 w-8 -translate-x-1/2 rounded-full bg-[var(--clr-primary)] text-white flex items-center justify-center text-xs font-semibold shadow",style:{left:"".concat(o,"%")},"aria-hidden":!0,children:[d,"/",n]})]}),(0,r.jsxs)("div",{className:"mt-3",children:[(0,r.jsxs)("div",{className:"text-xs text-[var(--clr-muted)]",children:["Step ",d," of ",n]}),(0,r.jsx)("div",{className:"text-lg font-semibold leading-tight",children:null!=(a=null==(t=i[s])?void 0:t.title)?a:""})]})]})})}var p=a(926);let f=(0,p.createServerReference)("60bd1c6d5f0a6642e02a5ee467b80d9cca224c8983",p.callServer,void 0,p.findSourceMapURL,"submitQuoteAction");var g=a(6554);function b(e){let{className:t,...a}=e;return(0,r.jsx)(g.b,{"data-slot":"label",className:n("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",t),...a})}function j(e){let{className:t,type:a,...i}=e;return(0,r.jsx)("input",{type:a,"data-slot":"input",className:n("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",t),...i})}var N=a(8720);let y={ok:!1};function w(e){var t,a,s,l,n,d,o;let{vehicle:c,selections:u,selectedVariantIds:m}=e,[v,h,p]=(0,i.useActionState)(f,y);(0,i.useEffect)(()=>{if(v){if(v.ok&&v.orderUrl){N.oR.success("Quote submitted!");let e=setTimeout(()=>{window.location.href=v.orderUrl},900);return()=>clearTimeout(e)}!v.ok&&v.general&&N.oR.error(v.general)}},[v]);let g=e=>{var t;let{name:a}=e;return(null==v||null==(t=v.errors)?void 0:t[a])?(0,r.jsx)("p",{className:"mt-1 text-xs text-red-600",children:v.errors[a]}):null};return(0,r.jsxs)("form",{action:h,className:"grid gap-4 sm:grid-cols-2",children:[(0,r.jsx)("input",{type:"hidden",name:"vehicleId",value:c||""}),(0,r.jsx)("input",{type:"hidden",name:"selectionsJSON",value:JSON.stringify(u||{})}),(0,r.jsx)("input",{type:"hidden",name:"itemsJSON",value:JSON.stringify((m||[]).map(e=>({variantId:e})))}),(0,r.jsxs)("div",{children:[(0,r.jsx)(b,{htmlFor:"firstName",children:"First name"}),(0,r.jsx)(j,{id:"firstName",name:"firstName",autoComplete:"given-name","aria-invalid":!!(null==v||null==(t=v.errors)?void 0:t.firstName)}),(0,r.jsx)(g,{name:"firstName"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(b,{htmlFor:"lastName",children:"Last name"}),(0,r.jsx)(j,{id:"lastName",name:"lastName",autoComplete:"family-name","aria-invalid":!!(null==v||null==(a=v.errors)?void 0:a.lastName)}),(0,r.jsx)(g,{name:"lastName"})]}),(0,r.jsxs)("div",{className:"sm:col-span-2",children:[(0,r.jsx)(b,{htmlFor:"email",children:"Email"}),(0,r.jsx)(j,{id:"email",name:"email",type:"email",autoComplete:"email","aria-invalid":!!(null==v||null==(s=v.errors)?void 0:s.email)}),(0,r.jsx)(g,{name:"email"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(b,{htmlFor:"phone",children:"Phone"}),(0,r.jsx)(j,{id:"phone",name:"phone",autoComplete:"tel","aria-invalid":!!(null==v||null==(l=v.errors)?void 0:l.phone)}),(0,r.jsx)(g,{name:"phone"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(b,{htmlFor:"state",children:"State"}),(0,r.jsx)(j,{id:"state",name:"state",placeholder:"e.g. WA","aria-invalid":!!(null==v||null==(n=v.errors)?void 0:n.state)}),(0,r.jsx)(g,{name:"state"})]}),(0,r.jsxs)("div",{className:"sm:col-span-2",children:[(0,r.jsx)(b,{htmlFor:"postcode",children:"Postcode"}),(0,r.jsx)(j,{id:"postcode",name:"postcode","aria-invalid":!!(null==v||null==(d=v.errors)?void 0:d.postcode)}),(0,r.jsx)(g,{name:"postcode"})]}),(null==v||null==(o=v.errors)?void 0:o.items)&&(0,r.jsx)("div",{className:"sm:col-span-2",children:(0,r.jsx)("p",{className:"text-sm text-red-600",children:v.errors.items})}),(null==v?void 0:v.general)&&!v.ok&&(0,r.jsx)("div",{className:"sm:col-span-2",children:(0,r.jsx)("p",{className:"text-sm text-red-600",children:v.general})}),(0,r.jsx)("div",{className:"sm:col-span-2",children:(0,r.jsx)(x,{type:"submit",disabled:p,className:"w-full",children:p?"Submittingâ€¦":"Submit Quote"})})]})}function k(e){var t,a,s,l,n;let{data:m}=e,v=null!=(t=null==m?void 0:m.steps)?t:[],p=null!=(a=null==m?void 0:m.items)?a:[],f=null!=(s=null==m?void 0:m.vehicles)?s:[],[g,b]=(0,i.useState)(null),[j,N]=(0,i.useState)(0),y=null!=(l=v[j])?l:{id:"",title:"",selectionMode:"single",required:!1},[k,S]=(0,i.useState)({}),M=(0,i.useMemo)(()=>Array.from(new Set(p.flatMap(e=>Object.values(e.variantIdByStore||{})))),[p]),[_,I]=(0,i.useState)({variants:{}}),[O,C]=(0,i.useState)(!1);(0,i.useEffect)(()=>{let e=!1;if(M.length)return(async()=>{C(!0);try{let t=await fetch("/api/enrich",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({store:"autospec",variantIds:M})}),a=t.ok?await t.json():{variants:{}};e||I(a)}catch(t){e||I({variants:{}})}finally{e||C(!1)}})(),()=>{e=!0}},[M]);let z=j===v.length-1;function F(e){var t;return!!e&&("none"===e.selectionMode||("vehicle_select"===e.id?!!g:(null!=(t=k[e.id])?t:[]).length>0))}let A=p.filter(e=>e.stepId===y.id),E=null!=(n=k[y.id])?n:[],B=(0,i.useMemo)(()=>{let e=[];for(let[i,s]of Object.entries(k))for(let i of s){var t,a,r;let s=p.find(e=>e.id===i),l=null!=(r=null==s||null==(t=s.variantIdByStore)?void 0:t.autospec)?r:null==s||null==(a=s.variantIdByStore)?void 0:a.linex;l&&e.push(Number(l))}return e},[k,p]),J=(0,i.useMemo)(()=>(function(e,t){let a=0,r=0;for(let i of e){let e=null==t?void 0:t[String(i.variantId)];(null==e?void 0:e.price)!=null&&(a+=+e.price),(null==e?void 0:e.weight)!=null&&(r+=+e.weight)}return{price:a,weightKg:Math.round(r/1e3*10)/10}})(B.map(e=>({variantId:e})),null==_?void 0:_.variants),[B,_]);return(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)(h,{steps:v,stepIndex:j}),(0,r.jsxs)(d,{children:[(0,r.jsx)(o,{children:(0,r.jsx)(c,{className:"text-lg",children:y.title})}),(0,r.jsx)(u,{children:"vehicle_select"===y.id?(0,r.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-3",children:f.map(e=>(0,r.jsx)(x,{variant:g===e.id?"default":"outline",className:"w-full justify-start items-start text-left h-auto p-4 whitespace-normal break-words normal-case overflow-hidden",onClick:()=>b(e.id),"aria-pressed":g===e.id,children:(0,r.jsxs)("span",{className:"font-semibold break-words whitespace-normal",children:[e.make," ",e.model]})},e.id))}):"customer_form"===y.id?(0,r.jsx)(w,{vehicle:g,selections:k,selectedVariantIds:B}):(0,r.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-3",children:[A.map(e=>{var t;let a=E.includes(e.id),i=Object.values(e.variantIdByStore||{})[0],s=!!(null==_||null==(t=_.variants)?void 0:t[String(i)]);return(0,r.jsx)(x,{variant:a?"default":"outline",className:"w-full justify-start items-start text-left h-auto p-4 whitespace-normal break-words normal-case overflow-hidden",onClick:()=>{var t;return t=e.id,void S(e=>{var a;let r=new Set(null!=(a=e[y.id])?a:[]);return r.has(t)?r.delete(t):("single"===y.selectionMode&&r.clear(),r.add(t)),{...e,[y.id]:Array.from(r)}})},"aria-pressed":a,children:(0,r.jsxs)("div",{className:"flex flex-col items-start",children:[(0,r.jsx)("span",{className:"font-semibold break-words whitespace-normal",children:e.name}),(0,r.jsx)("span",{className:"text-xs text-[var(--clr-muted)]",children:O?"Loadingâ€¦":s?"View details":""})]})},e.id)}),0===A.length&&(0,r.jsx)("div",{className:"text-sm text-[var(--clr-muted)]",children:"No options defined for this step yet."})]})})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)(x,{variant:"outline",onClick:function(){N(e=>Math.max(0,e-1))},disabled:0===j,children:"Back"}),"customer_form"!==y.id&&(0,r.jsx)(x,{onClick:function(){z||N(e=>Math.min(v.length-1,e+1))},disabled:y.required&&!F(y),title:y.required&&!F(y)?"Select an option to continue":void 0,children:z?"Get Quote":"Next"})]}),(0,r.jsxs)(d,{children:[(0,r.jsx)(o,{children:(0,r.jsx)(c,{className:"text-base",children:"Summary"})}),(0,r.jsxs)(u,{className:"space-y-1",children:[(0,r.jsx)("div",{className:"text-sm text-[var(--clr-muted)]",children:"Running total"}),(0,r.jsxs)("div",{className:"text-3xl font-bold",children:["$",J.price.toLocaleString()]}),(0,r.jsxs)("div",{className:"text-sm",children:["Weight: ",J.weightKg," kg"]})]})]})]})}},6765:(e,t,a)=>{Promise.resolve().then(a.bind(a,790))}},e=>{e.O(0,[720,723,441,255,358],()=>e(e.s=6765)),_N_E=e.O()}]);